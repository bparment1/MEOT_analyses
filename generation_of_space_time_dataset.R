########################################       Generation of space-time dataset       #######################################
########################################### For Testing MSSA-MEOT and S-T mode PCA #####################################
#This script generates synthetic space time dataset in R to test EOT,MEOT,PCA and MSSA.
#Output format can be chosen between IDRISI raster and tif.
#Space-time series can be generated by combining a set of spatial patterns and temporal patterns. 
#This script uses 11 functions stored in a separate file: generation_of_space_time_dataset_functions_09042013v5.R.
#AUTHORS: Benoit Parmentier                                             
#DATE: 12/31/2013                                                                                
#PROJECT: Clark Labs, MEOT, time series             
#TO DO:
#Write trajectory function...
###################################################################################################

###Loading R library and packages                                                      

library(gtools)   # loading various useful tools such as mixedsort 
library(sp)        #Spatial object models and functionality
library(raster)    #Raster functionality
library(rasterVis) #Raster visualization
library(rgdal)     #GDAL binding
library(vegan) 
library(parallel)   # parallelization based on snow
library(mgcv)                                # GAM package by Simon Wood
library(spdep)                               # Spatial pacakge with methods and spatial stat. by Bivand et al.
library(gstat)                               # Kriging and co-kriging by Pebesma et al.
library(fields)                              # NCAR Spatial Interpolation methods such as kriging, splines
library(foreign)                             # Library for format exchange (e.g. dbf,spss,sas etc.)
library(gdata)                               # various tools with xls reading
library(xts)                                 # basic package for time series analysis
library(zoo)                                 # basic package for time series analysis
library(forecast)                            # package containing ARIMA procedures
library(plotrix)
library(matrixStats) 

##### Functions used in this script #####

functions_generation_space_time_datasets <- "generation_of_space_time_dataset_functions_12312013v6.R"

script_path<-"/Users/benoitparmentier/Dropbox/Data/MEOT_paper/R_scripts_12312013" #path to script
source(file.path(script_path,functions_generation_space_time_datasets)) #source all functions used in this script.

############# Parameters and arguments ####################

in_dir <- "/Users/benoitparmentier/Dropbox/Data/MEOT_paper/MEOT12272012/3x3dataset"
out_dir<- "/Users/benoitparmentier/Dropbox/Data/MEOT_paper/"

if (!file.exists(out_dir)){
  dir.create(out_dir)
  #} else{
  #  out_path <-paste(out_path..)
}
setwd(out_dir)

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"none" #c("unif","norm","none") 
#distribution_val_i <-"unif" #c("unif","norm","none")
sd_val<-1
mean_val<-0
seed_nb<-100
file_format <-".rst"
NA_flag_val <- -9999
out_suffix <- "gen_11252013"

#########################################################
#################### BEGIN SCRIPT ########################

##### PART I : Prepare input temporal and spatial patterns #####

#step 1: generate reference raster image/region

list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i","out_suffix","out_dir","seed_nb")

r <- generate_raster_region(1,list_param_gen_raster)
plot(r)

#step 2: generate spatial structure
#step 2: generate reference spatial patterns

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"none" #c("unif","norm","none") 
#distribution_val_i <-"unif" #c("unif","norm","none") 
file_format <-".rst"
NA_flag_val <- -9999
#out_suffix <- "gen_11252013"

#note that r is the raste image!!
list_param_adding_spatial_structure <-list(j,r,proj_str,range_val,NA_flag_val,file_format,out_suffix, out_dir)
names(list_param_adding_spatial_structure)<-c("j","r","proj_str","range_val","NA_flag_val","file_format","out_suffix","out_dir")

r_spat_s <-adding_sptatial_structure(1,list_param_adding_spatial_structure)
plot(r_spat_s) #examine available pattern
r_trend_x <- (subset(r_spat_s,"trend_x")) #examine available pattern

#Generate moving structure? Not in this case...

#Step 3: generate temporal structure

#Nothing generated in this particular dataset (see other versions)

#######################################################
######## PART II : Generate space-time datasets using input temporal and spatial patterns =
#NOW create a few datasets for the MEOT and MSSA/PCA diagnostics...

#there are currently 5 datasets generated...

list_temp_pattern_produced <- vector("list",length=5)
#quartz(13,8)

####### DATASET 1, DATASET 2 : SIMULATED RED NOISE 3x3, AR1= 0.9294, 
# Dataset 1: no geography (constant)
# Dataset 2: gradient (trend in x) first day

#step 1: generate raster image/region
#Now generate random images to add to the sequence...

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"norm" #c("unif","norm","none")
sd_val<- 1
mean_val<-0
file_format <-".rst"
NA_flag_val <- -9999
seed_nb <- 100
list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,
                            mean_val,sd_val,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i",
                                "mean_val","sd_val","out_suffix","out_dir","seed_nb")
random_r <- generate_raster_region(1,list_param_gen_raster)
plot(random_r) #random spatial image which is the start of the red noise time series.
#random_r <- raster("/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/raster_3r_3c_ts_1_r4_rednoise_test3x3_gen_11152013.rst")

#generate red noise for every pixels...this should be  modified for large images...

t0_val <- 2
ar1_coef <- 0.9294 #AR1 for MEOT1
nt<-45
seed_nb <- 100
#t0_val <- 1
#temp_test2 <- gen_ar1_ts_fun(t0_val,ar1_coef,nt,sd_rd=1,mean_rd=0,seed_nb)

#run 9 times function to derived red noise series, not teh first val is random image
pix_nb <- (col*row)
seed_nb<-100:(100+pix_nb-1)
temp_rednoise_s <- lapply(1:9,FUN=gen_ar1_ts_fun,t0_val=values(random_r),ar1_coef=ar1_coef,
                          nt=45,sd_rd=1,mean_rd=0,seed_nb)

df <- do.call(cbind,temp_rednoise_s)
plot(ts(df)) #show all the time series
#spectrum(temp_rednoise_s[[2]])
#arima_mod2 <- arima(temp_rednoise_s[[2]], order = c(1,0,0))

r <- subset(r_spat_s,"constant") #base image is at 1 ...
r_stack <- generate_stack_raster(r,nt)
#Prepare to generate images combining time and space
out_suffix_s <- paste("r1_rednoise_AR92_constant_",out_suffix,sep="")
operation="multiplication"
#undebug(combine_space_time_structure)
#This is output without random component...
r1_rednoise_AR92_c <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                     out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

#dataset 2 with gradient geography (Trend x)
trend_x <- subset(r_spat_s,"trend_x") #base image is at 1 ...
trend_x <- (trend_x + 1)*0.5
r_stack <- generate_stack_raster(trend_x,nt)
out_suffix_s <- paste("r2_rednoise_AR92_trend_x_",out_suffix,sep="")
operation="multiplication"
r2_rednoise_AR92_gx <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                    out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

#r44<- stack(list.files(pattern=".*.rst$",
#                       path="/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/",
#                       full.names=T))
#r_random_s <- stack(lapply(1:nt,FUN=generate_raster_region,list_param=list_param_gen_raster))
temp.colors <- colorRampPalette(c('blue', 'white', 'red'))
levelplot(r2_rednoise_AR92_gx,layers=1:nt,col.regions=temp.colors)
levelplot(r1_rednoise_AR92_c,layers=1:nt,col.regions=temp.colors)

r1<-subset(r2_rednoise_AR92_gx,1)
tt<- r1 - random_r #should not be zero raster 

#Now write out to disk
out_suffix_s <- paste("r1_rednoise_AR92_constant_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r1 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))

#Change to zip files in R rather than Linux/MacOs/Unix, use zip from zip Utils R works 
#accross platforms (i.e. Windows)
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)

out_suffix_s <- paste("r2_rednoise_AR92_trend_x_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r2 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)

####### DATASET 3 and DATASET 4: SIMULATED RED NOISE 3x3, AR1= 0.5, 
# Dataset 3: no geography (constant)
# Dataset 4: gradient (trend in x)

#step 1: generate raster image/region
#Now generate random images to add to the sequence...(same as previously)

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"norm" #c("unif","norm","none")
sd_val<- 1
mean_val<-0
file_format <-".rst"
NA_flag_val <- -9999
seed_nb <- 100
list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,
                            mean_val,sd_val,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i",
                                "mean_val","sd_val","out_suffix","out_dir","seed_nb")
random_r <- generate_raster_region(1,list_param_gen_raster)
plot(random_r) #random spatial image which is the start of the red noise time series.
#random_r <- raster("/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/raster_3r_3c_ts_1_r4_rednoise_test3x3_gen_11152013.rst")

#generate red noise for every pixels...this should be  modified for large images...

t0_val <- 2
ar1_coef <- 0.5 #AR1 for test
nt<-45
seed_nb <- 100
#t0_val <- 1
#temp_test2 <- gen_ar1_ts_fun(t0_val,ar1_coef,nt,sd_rd=1,mean_rd=0,seed_nb)

#run 9 times function to derived red noise series, not teh first val is random image
pix_nb <- (col*row)
seed_nb<-100:(100+pix_nb-1)
temp_rednoise_s <- lapply(1:9,FUN=gen_ar1_ts_fun,t0_val=values(random_r),ar1_coef=ar1_coef,
                          nt=45,sd_rd=1,mean_rd=0,seed_nb)

df <- do.call(cbind,temp_rednoise_s)
plot(ts(df)) #show all the time series
#spectrum(temp_rednoise_s[[2]])
#arima_mod2 <- arima(temp_rednoise_s[[2]], order = c(1,0,0))

r <- subset(r_spat_s,"constant") #base image is at 1 ...
r_stack <- generate_stack_raster(r,nt)
#Prepare to generate images combining time and space
out_suffix_s <- paste("r3_rednoise_AR50_constant_",out_suffix,sep="")
operation="multiplication"
#undebug(combine_space_time_structure)
#This is output without random component...
r3_rednoise_AR50_c <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                    out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

#dataset 2 with gradient geography (Trend x)
trend_x <- subset(r_spat_s,"trend_x") #base image is at 1 ...
trend_x <- (trend_x + 1)*0.5
r_stack <- generate_stack_raster(trend_x,nt)
out_suffix_s <- paste("r4_rednoise_AR50_trend_x_",out_suffix,sep="")
operation="multiplication"
r4_rednoise_AR50_gx <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                     out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

#r44<- stack(list.files(pattern=".*.rst$",
#                       path="/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/",
#                       full.names=T))
#r_random_s <- stack(lapply(1:nt,FUN=generate_raster_region,list_param=list_param_gen_raster))
temp.colors <- colorRampPalette(c('blue', 'white', 'red'))
levelplot(r4_rednoise_AR50_gx,layers=1:nt,col.regions=temp.colors)
levelplot(r3_rednoise_AR50_c,layers=1:nt,col.regions=temp.colors)

r1<-subset(r4_rednoise_AR50_gx,1)
tt<- r1 - random_r #should be zero raster 

#Now write out to disk
out_suffix_s <- paste("r3_rednoise_AR50_constant_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r3 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))

#Change to zip files in R rather than Linux/MacOs/Unix, use zip from zip Utils R works 
#accross platforms (i.e. Windows)
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)

out_suffix_s <- paste("r4_rednoise_AR50_trend_x_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r4 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)


####### DATASET 5,  SIMULATED RED NOISE 3x3, AR1= 0.9294, 
# Dataset 5: gradient (trend in x) first day

#step 1: generate raster image/region
#Now generate random images to add to the sequence...

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"norm" #c("unif","norm","none")
sd_val<- 1
mean_val<-0
file_format <-".rst"
NA_flag_val <- -9999
seed_nb <- 100
list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,
                            mean_val,sd_val,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i",
                                "mean_val","sd_val","out_suffix","out_dir","seed_nb")
random_r <- generate_raster_region(1,list_param_gen_raster)
plot(random_r) #random spatial image which is the start of the red noise time series.
#random_r <- raster("/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/raster_3r_3c_ts_1_r4_rednoise_test3x3_gen_11152013.rst")

#generate red noise for every pixels...this should be  modified for large images...

ar1_coef <- 0.9294 #AR1 for MEOT1
nt<-45
seed_nb <- 100
#dataset 2 with gradient geography (Trend x)
trend_x <- subset(r_spat_s,"trend_x") #base image is at 1 ...
trend_x <- (trend_x + 1)*0.5

#run 9 times function to derived red noise series, not teh first val is random image
pix_nb <- (col*row)
seed_nb<-100:(100+pix_nb-1)
temp_rednoise_s <- lapply(1:9,FUN=gen_ar1_ts_fun,t0_val=values(trend_x),ar1_coef=ar1_coef,
                          nt=45,sd_rd=1,mean_rd=0,seed_nb)

df <- do.call(cbind,temp_rednoise_s)
plot(ts(df)) #show all the time series
#spectrum(temp_rednoise_s[[2]])
#arima_mod2 <- arima(temp_rednoise_s[[2]], order = c(1,0,0))

r <- subset(r_spat_s,"constant") #base image is at 1 ...
r_stack <- generate_stack_raster(r,nt)
#Prepare to generate images combining time and space
out_suffix_s <- paste("r5_rednoise_AR92_trend_x1_",out_suffix,sep="")
operation="multiplication"
#undebug(combine_space_time_structure)
#This is output without random component...
r5_rednoise_AR92_gx1 <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                    out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

temp.colors <- colorRampPalette(c('blue', 'white', 'red'))
levelplot(r5_rednoise_AR92_gx1,layers=1:nt,col.regions=temp.colors)
levelplot(r2_rednoise_AR92_gx,layers=1:nt,col.regions=temp.colors)

r1<-subset(r5_rednoise_AR92_gx1,1)
tt<- r1 - trend_x #should not be zero raster 

#Now write out to disk
out_suffix_s <- paste("r5_rednoise_AR92_trend_x1_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r5 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))

#Change to zip files in R rather than Linux/MacOs/Unix, use zip from zip Utils R works 
#accross platforms (i.e. Windows)
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)

####### DATASET 6,  SIMULATED RED NOISE 3x3, AR1= 0.5, 
# Dataset 6: gradient (trend in x) first day

#step 1: generate raster image/region
#Now generate random images to add to the sequence...

j <- 45 #number of images
col <- 3 # number of columns in the images 
row <- 3 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"norm" #c("unif","norm","none")
sd_val<- 1
mean_val<-0
file_format <-".rst"
NA_flag_val <- -9999
seed_nb <- 100
list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,
                            mean_val,sd_val,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i",
                                "mean_val","sd_val","out_suffix","out_dir","seed_nb")
random_r <- generate_raster_region(1,list_param_gen_raster)
plot(random_r) #random spatial image which is the start of the red noise time series.
#random_r <- raster("/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/raster_3r_3c_ts_1_r4_rednoise_test3x3_gen_11152013.rst")

#generate red noise for every pixels...this should be  modified for large images...

ar1_coef <- 0.5 #AR1 coef
nt<-45
seed_nb <- 100
#dataset 2 with gradient geography (Trend x)
trend_x <- subset(r_spat_s,"trend_x") #base image is at 1 ...
trend_x <- (trend_x + 1)*0.5

#run 9 times function to derived red noise series, not teh first val is random image
pix_nb <- (col*row)
seed_nb<-100:(100+pix_nb-1)
temp_rednoise_s <- lapply(1:9,FUN=gen_ar1_ts_fun,t0_val=values(trend_x),ar1_coef=ar1_coef,
                          nt=45,sd_rd=1,mean_rd=0,seed_nb)

df <- do.call(cbind,temp_rednoise_s)
plot(ts(df)) #show all the time series
#spectrum(temp_rednoise_s[[2]])
#arima_mod2 <- arima(temp_rednoise_s[[2]], order = c(1,0,0))

r <- subset(r_spat_s,"constant") #base image is at 1 ...
r_stack <- generate_stack_raster(r,nt)
#Prepare to generate images combining time and space
out_suffix_s <- paste("r6_rednoise_AR50_trend_x1_",out_suffix,sep="")
operation="multiplication"
#undebug(combine_space_time_structure)
#This is output without random component...
r6_rednoise_AR50_gx1 <- convert_multiple_ts_to_raster(list_temp_pattern=temp_rednoise_s,r_stack,
                                                      out_suffix_s,NA_flag_val,file_format,out_dir,operation="multiplication")

temp.colors <- colorRampPalette(c('blue', 'white', 'red'))
levelplot(r6_rednoise_AR50_gx1,layers=1:nt,col.regions=temp.colors)
levelplot(r4_rednoise_AR50_gx,layers=1:nt,col.regions=temp.colors)

r1<-subset(r6_rednoise_AR50_gx1,1)
tt<- r1 - trend_x #should not be zero raster 

#Now write out to disk
out_suffix_s <- paste("r5_rednoise_AR92_trend_x1_",out_suffix,sep="")
out_prefix_str <- "test_3c_3r_"
list_r5 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_suffix_s,out_prefix=out_prefix_str))

#Change to zip files in R rather than Linux/MacOs/Unix, use zip from zip Utils R works 
#accross platforms (i.e. Windows)
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", out_suffix_s,sep="")
system(system_cmd)

########## Generating longer sine signal...

out_suffix <-"MEOT_01092014"
in_dir <- "/Users/benoitparmentier/Dropbox/Data/MEOT_paper/MEOT12272012/3x3dataset"
out_dir<- "/Users/benoitparmentier/Documents/DATA/Benoit/Clark_University/Paper_writings/MSSA_BNP/"

out_dir_name <- paste("analyses_and_figures","_",out_suffix,sep="")
out_dir <- file.path(out_dir,out_dir_name)
if (!file.exists(out_dir)){
  dir.create(out_dir)
  #} else{
  #  out_path <-paste(out_path..)
}
setwd(out_dir)


sine_inDir <- "/Users/benoitparmentier/Dropbox/Data/MEOT_paper/MEOT12272012/9x9sine"
MEOT_inDir <- "/Users/benoitparmentier/Dropbox/Data/MEOT_paper/MEOT12272012/MEOT_9x9sine"

r_test_sine <- stack(list.files(pattern="Cover9.*.rst$",path=sine_inDir,full.names=T))
r_test_sine2 <- r_test_sine * 1

j <- 90 #number of images
col <- 9 # number of columns in the images 
row <- 9 # number of rows in the images

proj_str <- NA #projection string (use PROJ4 convention or "NA")
range_val <- c(0,1)
distribution_val_i <-"norm" #c("unif","norm","none")
sd_val<- 1
mean_val<- 0
file_format <-".rst"
NA_flag_val <- -9999
seed_nb <- 100:(100+j-1)
list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,
                            mean_val,sd_val,out_suffix, out_dir,seed_nb)
names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i",
                                "mean_val","sd_val","out_suffix","out_dir","seed_nb")
random_r <- stack(lapply(1:90,FUN=generate_raster_region,list_param=list_param_gen_raster))
random_r <- random_r/10000                   
levelplot(random_r) #random spatial image which is the start of the red noise time series.
#random_r <- raster("/Users/benoitparmentier/Dropbox/Data/MEOT_paper/r4_rednoise_test3x3_gen_11152013/raster_3r_3c_ts_1_r4_rednoise_test3x3_gen_11152013.rst")

r_test_sine_90 <- stack(r_test_sine, r_test_sine2)
r_test_sine_90 <- r_test_sine_90 + random_r

l_names <-paste((paste("sine9x9_90",1:90,sep="_")))
l2_names <-paste(l_names,rep(paste("s",1:9,sep=""),10),sep="_")
layerNames(r_test_sine_90) <- l2_names
levelplot(r_test_sine_90,layers=1:9,col.regions=matlab.like(18))
nlayers(r_test_sine_90)
levelplot(r_test_sine,col.regions=matlab.like(18))

r_sine_90 <- write_out_raster_fun(r_test_sine_90,out_suffix,out_dir,NA_flag_val=-9999,file_format=".rst")

#Now write out to disk
#out_suffix_s <- paste("sine9x9_90_",out_suffix,sep="")
out_suffix_s <- "sine9x9_90_"
out_prefix_str <- "test_"
list_r5 <- mixedsort(create_idrisi_rgf(file_pat="",out_suffix_s,in_dir=out_dir,out_prefix=out_prefix_str))

              
#Change to zip files in R rather than Linux/MacOs/Unix, use zip from zip Utils R works 
#accross platforms (i.e. Windows)
#zip sine9x9_90.zip s*sine9x9_90*
system_cmd <- paste("zip -r ",out_suffix_s,".zip ", paste("*",out_suffix_s,"*",sep=""),sep="")
system(system_cmd)


#j <- 90 #number of images
#col <- 9 # number of columns in the images 
#row <- 9 # number of rows in the images

#proj_str <- NA #projection string (use PROJ4 convention or "NA")
#range_val <- c(0,1)
#distribution_val_i <-"none" #c("unif","norm","none") 
#distribution_val_i <-"unif" #c("unif","norm","none")
#sd_val<-1
#mean_val<-0
#seed_nb<-100
#file_format <-".rst"
#NA_flag_val <- -9999
#out_suffix <-"MEOT_01092014"



#list_param_gen_raster<-list(j,col,row,proj_str,range_val,NA_flag_val,distribution_val_i,out_suffix, out_dir,seed_nb)
#names(list_param_gen_raster)<-c("j","col","row","proj_str","range_val","NA_flag_val","distribution_val_i","out_suffix","out_dir","seed_nb")

r <- generate_raster_region(1,list_param_gen_raster)
plot(r)


combine_space_time_structure

#####################################################
################    END OF SCRIPT    ##############

